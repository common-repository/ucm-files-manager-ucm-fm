!function(e,t){if("function"==typeof define&&define.amd)define(["elfinder"],e);else if(t){var i=t.prototype._options.commandsOptions.edit.editors;t.prototype._options.commandsOptions.edit.editors=i.concat(e(t))}}(function(e){"use strict";function h(e,t){var i=(a=a||t.arrayFlip(f))[e]||t.mimeTypes[e];return"jpeg"===i&&(i="jpg"),i}function v(e,t){var i=$.Deferred();try{var a=document.createElement("canvas"),n=a.getContext("2d"),o=new Image;return o.src=e,$(o).on("load",function(){try{a.width=o.width,a.height=o.height,n.drawImage(o,0,0),function(){var e;((e=a.toDataURL(t).match(/^data:([a-z0-9]+\/[a-z0-9.+-]+)/i))?e[1]:"").toLowerCase()===t.toLowerCase()?i.resolve(a.toDataURL(t),a):i.reject()}()}catch(e){i.reject()}}).on("error",function(){i.reject()}),i}catch(e){return i.reject()}}var a,t=window.location.search.match(/getfile=([a-z]+)/),s=(e.prototype.hasRequire,function(){var t;try{t=!!new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(e){t=!!(void 0===window.orientation||navigator&&navigator.mimeTypes["application/x-shockwave-flash"])}return t}()),f={bmp:"image/x-ms-bmp",dng:"image/x-adobe-dng",gif:"image/gif",jpeg:"image/jpeg",jpg:"image/jpeg",pdf:"application/pdf",png:"image/png",ppm:"image/x-portable-pixmap",psd:"image/vnd.adobe.photoshop",pxd:"image/x-pixlr-data",svg:"image/svg+xml",tiff:"image/tiff",webp:"image/webp",xcf:"image/x-xcf",sketch:"application/x-sketch",php:"text/x-php",phpx:"application/x-php"};!function(){if(s&&window.parent!==window){var e,t,i,a,n,o=window.location.search.match(/[?&]pixlr=([^&]+)/),r=window.location.search.match(/[?&]image=([^&]+)/);o&&(t=(e=window.parent).$("#"+o[1]+"iframe").hide(),a=e.$("#"+o[1]).data("resizeoff")(),"http"===r[1].substr(0,4)?(n=(i=r[1]).replace(/.+\.([^.]+)$/,"$1"),a.data("ext")!==n&&a.closest(".ui-dialog").trigger("changeType",{extention:n,mime:f[n]}),"https:"===window.location.protocol&&(i=i.replace(/^http:/,"https:")),a.on("load error",function(){a.data("loading")(!0)}).attr("src",i).data("loading")()):a.data("loading")(!0),t.trigger("destroy").remove())}}(),t&&"ckeditor"===(t=t[1])&&(e.prototype._options.getFileCallback=function(e,t){var i,a;window.opener.CKEDITOR.tools.callFunction((i=new RegExp("(?:[?&]|&amp;)CKEditorFuncNum=([^&]+)","i"),(a=window.location.search.match(i))&&1<a.length?a[1]:""),t.convAbsUrl(e.url)),t.destroy(),window.close()});var i=JSON.parse(phprockets_ucm_fm.ucm_fm_settings_active_editors),n=[];return parseInt(i.fm_photopea_editor_enable)&&""!==i.fm_image_edit_file_types&&n.push({info:{id:"photopea",name:"Edit With Photopea",iconImg:"img/editor-icons.png 0 -160",single:!0,noContent:!0,arrayBufferContent:!0,openMaximized:!0,canMakeEmpty:!0,integrate:{title:"Photopea",link:"https://www.photopea.com/learn/"}},mimes:i.fm_image_edit_file_types.split(","),html:'<iframe style="width:100%;height:100%;border:none;"></iframe>',setup:function(e,t){(t.UA.IE||t.UA.Mobile)&&(this.disabled=!0)},init:function(e,t,i,d){function l(e){var t=h(e,d),i=f[t];return s.mimesFlip[i]?"jpeg"===t&&(t="jpg"):t="",t&&m[t]||(i=f[t="psd"],o.closest(".ui-dialog").trigger("changeType",{extention:t,mime:i,keepEditor:!0})),t}var a,n,p="https://www.photopea.com",o=$(this).hide().on("load",function(){o.show()}).on("error",function(){c.remove(),o.show()}),r=this.editor,s=r.confObj,c=$('<div class="elfinder-edit-spinner elfinder-edit-photopea"/>').html('<span class="elfinder-spinner-text">'+d.i18n("nowLoading")+'</span><span class="elfinder-spinner"/>').appendTo(o.parent()),m=d.arrayFlip(["jpg","png","gif","bmp","tiff","webp"]),u=t.mime;s.mimesFlip||(s.mimesFlip=d.arrayFlip(s.mimes,!0)),s.liveMsg||(s.liveMsg=function(i,e,t){var a=d.openUrl(t.hash);d.isSameOrigin(a)||(a=d.openUrl(t.hash,!0));var n,o=i.get(0).contentWindow,r=0,s=null,c=$.Deferred().done(function(){e.remove(),r=1,o.postMessage(s,"*")});this.load=function(){return d.request({data:{cmd:"get"},options:{url:a,type:"get",cache:!0,dataType:"binary",responseType:"arraybuffer",processData:!1}}).done(function(e){s=e})},this.receive=function(e){var t=e.originalEvent;t.origin===p&&t.source===o&&("done"===t.data?0===r?c.resolve():1===r?(r=2,i.trigger("contentsloaded")):n&&"pending"===n.state()&&n.reject("errDataEmpty"):n&&"pending"===n.state()&&("object"==typeof t.data?n.resolve("data:"+u+";base64,"+d.arrayBufferToBase64(t.data)):n.reject("errDataEmpty")))},this.getContent=function(){var e,t;if(1<r)return n&&"pending"===n.state()&&n.reject(),n=null,n=$.Deferred(),2===r?(r=3,n.resolve("data:"+u+";base64,"+d.arrayBufferToBase64(s)),s=null):(i.data("mime")&&(u=i.data("mime"),e=l(u)),(t=i.data("quality"))&&(e+=":"+t/100),o.postMessage('app.activeDocument.saveToOE("'+e+'")',p)),n}}),o.parent().css("padding",0),l(t.mime),a=r.liveMsg=new s.liveMsg(o,c,t),$(window).on("message."+d.namespace,a.receive),a.load().done(function(){var e=JSON.stringify({files:[],environment:{lang:d.lang.replace(/_/g,"-")}});o.attr("src",p+"/#"+encodeURI(e))}).fail(function(e){e&&d.error(e),r.initFail=!0}),"image/jpeg"!==t.mime&&"image/webp"!==t.mime||(o.data("quality",d.storage("jpgQuality")||d.option("jpgQuality")),n=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=n.val();o.data("quality",e)}).val(o.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').append($("<span>").html(d.i18n("quality")+" : "),n,$("<span/>")).prependTo(o.parent().next()))},load:function(e){var t=$.Deferred(),i=this,a=(this.fm,$(e));return i.initFail?t.reject():a.on("contentsloaded",function(){t.resolve(i.liveMsg)}),t},getContent:function(){return this.editor.liveMsg?this.editor.liveMsg.getContent():void 0},save:function(e,t){var i,a=$(e),n=a.data("quality"),o=a.data("hash");void 0!==n&&this.fm.storage("jpgQuality",n),o?(i=this.fm.file(o),a.data("mime",i.mime)):a.removeData("mime")},close:function(e,t){$(e).attr("src",""),t&&$(window).off("message."+this.fm.namespace,t.receive)}}),parseInt(i.fm_tui_editor_enable)&&""!==i.fm_image_edit_file_types&&n.push({info:{id:"tuiimgedit",name:"Edit With TUI",iconImg:"img/editor-icons.png 0 -48",dataScheme:!0,schemeContent:!0,openMaximized:!0,canMakeEmpty:!1,integrate:{title:"TOAST UI Image Editor",link:"http://ui.toast.com/tui-image-editor/"}},mimes:i.fm_image_edit_file_types.split(","),html:'<div class="elfinder-edit-imageeditor"><canvas></canvas></div>',setup:function(e,t){t.UA.ltIE8||t.UA.Mobile?this.disabled=!0:(this.opts=Object.assign({version:"latest"},e.extraOptions.tuiImgEditOpts||{},{iconsPath:t.baseUrl+"img/tui-",theme:{}}),t.isSameOrigin(this.opts.iconsPath)||(this.disabled=!0,t.debug("warning","Setting `commandOptions.edit.extraOptions.tuiImgEditOpts.iconsPath` MUST follow the same origin policy.")))},init:function(e,t,i,a){this.data("url",i)},load:function(v){function t(e){var t,i,a,s,n=$(v),o=n.parent(),r=x.confObj.opts,c=r.iconsPath,d=$('<div class="tui-image-editor-container">').appendTo(o),l=[$('<div class="tui-image-editor-submenu"/>').appendTo(d),$('<div class="tui-image-editor-controls"/>').appendTo(d)],p=new e(v,{includeUI:{loadImage:{path:n.data("url"),name:x.file.name},theme:Object.assign(r.theme,{"menu.normalIcon.path":c+"icon-d.svg","menu.normalIcon.name":"icon-d","menu.activeIcon.path":c+"icon-b.svg","menu.activeIcon.name":"icon-b","menu.disabledIcon.path":c+"icon-a.svg","menu.disabledIcon.name":"icon-a","menu.hoverIcon.path":c+"icon-c.svg","menu.hoverIcon.name":"icon-c","submenu.normalIcon.path":c+"icon-d.svg","submenu.normalIcon.name":"icon-d","submenu.activeIcon.path":c+"icon-c.svg","submenu.activeIcon.name":"icon-c"}),initMenu:"filter",menuBarPosition:"bottom"},cssMaxWidth:Math.max(300,o.width()),cssMaxHeight:Math.max(200,o.height()-(l[0].height()+l[1].height()+3)),usageStatistics:!1}),m=n.find("canvas:first").get(0),u=function(e){if(void 0!==e){var t,i,a=$(m),n=parseInt(a.attr("width")),o=parseInt(a.attr("height")),r=n/o;0===e?(t=n,i=o):(i=(t=parseInt(a.css("max-width"))+Number(e))/r,n<t&&o<i&&(t=n,i=o)),h.text(Math.round(t/n*100)+"%"),p.resizeCanvasDimension({width:t,height:i}),s&&setTimeout(function(){s&&u(e)},50)}},f=$('<span class="ui-icon ui-icon-plusthick"/>').data("val",10),g=$('<span class="ui-icon ui-icon-minusthick"/>').data("val",-10),h=$("<button/>").css("width","4em").text("%").attr("title","100%").data("val",0);d.remove(),n.removeData("url").data("mime",x.file.mime),"image/jpeg"===x.file.mime?(n.data("quality",b.storage("jpgQuality")||b.option("jpgQuality")),t=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=t.val();n.data("quality",e),i&&cancelAnimationFrame(i),i=requestAnimationFrame(function(){m.toBlob(function(e){e&&t.next("span").text(" ("+b.formatSize(e.size)+")")},"image/jpeg",Math.max(Math.min(e,100),1)/100)})}).val(n.data("quality")),$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').append($("<span>").html(b.i18n("quality")+" : "),t,$("<span/>")).prependTo(n.parent().next())):"image/svg+xml"===x.file.mime&&n.closest(".ui-dialog").trigger("changeType",{extention:"png",mime:"image/png",keepEditor:!0}),$('<div class="ui-dialog-buttonset elfinder-edit-extras"/>').append(g,h,f).attr("title",b.i18n("scale")).on("click","span,button",function(){u($(this).data("val"))}).on("mousedown mouseup mouseleave","span",function(e){s=!1,a&&clearTimeout(a),"mousedown"===e.type&&(a=setTimeout(function(){s=!0,u($(e.target).data("val"))},500))}).prependTo(n.parent().next()),setTimeout(function(){y.resolve(p),t&&(t.trigger("change"),p.on("redoStackChanged undoStackChanged",function(){t.trigger("change")})),u(null)},100)}var i,x=this,b=this.fm,y=$.Deferred(),e=b.options.cdns,a=x.confObj.opts.version;return x.confObj.editor?t(x.confObj.editor):(i=$.Deferred(),b.loadCss([e.tui+"/tui-color-picker/latest/tui-color-picker.css",e.tui+"/tui-image-editor/"+a+"/tui-image-editor.css"]),b.hasRequire?(require.config({paths:{"fabric/dist/fabric.require":e.fabric16+"/fabric.require.min","tui-code-snippet":e.tui+"/tui.code-snippet/latest/tui-code-snippet.min","tui-color-picker":e.tui+"/tui-color-picker/latest/tui-color-picker.min","tui-image-editor":e.tui+"/tui-image-editor/"+a+"/tui-image-editor.min"}}),require(["tui-image-editor"],function(e){i.resolve(e)})):b.loadScript([e.fabric16+"/fabric.min.js",e.tui+"/tui.code-snippet/latest/tui-code-snippet.min.js"],function(){b.loadScript([e.tui+"/tui-color-picker/latest/tui-color-picker.min.js"],function(){b.loadScript([e.tui+"/tui-image-editor/"+a+"/tui-image-editor.min.js"],function(){i.resolve(window.tui.ImageEditor)},{loadType:"tag"})},{loadType:"tag"})},{loadType:"tag"}),i.done(function(e){x.confObj.editor=e,t(e)})),y},getContent:function(e){var t=this.editor,i=t.fm,a=$(e),n=a.data("quality");if(t.instance)return"image/jpeg"===a.data("mime")&&(n=n||i.storage("jpgQuality")||i.option("jpgQuality"),n=Math.max(.1,Math.min(1,n/100))),t.instance.toDataURL({format:h(a.data("mime"),i),quality:n})},save:function(e){var t,i=$(e),a=i.data("quality"),n=i.data("hash");this.instance.deactivateAll(),void 0!==a&&this.fm.storage("jpgQuality",a),n&&(t=this.fm.file(n),i.data("mime",t.mime))}}),parseInt(i.fm_pixo_editor_enable)&&""!==i.fm_image_edit_file_types&&n.push({info:{id:"pixo",name:"Edit With Pixo",iconImg:"img/editor-icons.png 0 -208",dataScheme:!0,schemeContent:!0,single:!0,canMakeEmpty:!1,integrate:{title:"Pixo Editor",link:"https://pixoeditor.com/privacy-policy/"}},mimes:i.fm_image_edit_file_types.split(","),html:'<div class="elfinder-edit-imageeditor"><img/></div>',setup:function(e,t){!t.UA.ltIE8&&e.extraOptions&&e.extraOptions.pixo&&e.extraOptions.pixo.apikey?this.editorOpts=e.extraOptions.pixo:this.disabled=!0},init:function(e,t,i,a){(function(e,t,i,a){var n,o=$(this).children("img:first").data("ext",h(t.mime,a)),r=$('<div class="elfinder-edit-spinner elfinder-edit-image"/>').html('<span class="elfinder-spinner-text">'+a.i18n("ntfloadimg")+'</span><span class="elfinder-spinner"/>').hide().appendTo(this);i.match(/^data:/)||(n=a.openUrl(t.hash),o.attr("_src",i)),o.attr("id",e+"-img").attr("src",n||i).css({height:"","max-width":"100%","max-height":"100%",cursor:"pointer"}).data("loading",function(e){return o.closest(".elfinder-dialog").find("button,.elfinder-titlebar-button").prop("disabled",!e)[e?"removeClass":"addClass"]("ui-state-disabled"),o.css("opacity",e?"":"0.3"),r[e?"hide":"show"](),o})}).call(this,e,t,i,a)},getContent:function(){return $(this).children("img:first").attr("src")},load:function(o){function e(e){var t;f.length?f.appendTo(f.parent()):(f=$('<div id="elfinder-pixo-container" class="ui-front"/>').css({position:"fixed",top:0,right:0,width:"100%",height:$(window).height(),overflow:"hidden"}).hide().appendTo(n.hasClass("elfinder-fullscreen")?n:"body"),n.on("resize."+l.namespace,function(e,t){e.preventDefault(),e.stopPropagation(),t&&t.fullscreen&&f.appendTo("on"===t.fullscreen?n:"body")}),l.bind("destroy",function(){i&&i.cancelEditing(),f.remove()})),p.on("click",g),t=Object.assign({type:"child",parent:f.get(0),onSave:function(e){function i(e){p.one("load error",function(){p.data("loading")&&p.data("loading")(!0)}).attr("crossorigin","anonymous").attr("src",e)}var t=e.toBlob().type,a=h(t,l),n=e.toDataURL();p.data("loading")(),delete o._canvas,p.data("ext")!==a?v(n,d.file.mime).done(function(e,t){t&&(o._canvas=c=t,s.trigger("change"),r&&r.show()),i(e)}).fail(function(){m.trigger("changeType",{extention:a,mime:t}),i(n)}):i(n)},onClose:function(){m.removeClass(l.res("class","preventback")),l.toggleMaximize(f,!1),f.hide(),l.toFront(m)}},d.confObj.editorOpts),d.trigger("Prepare",{node:o,editorObj:Pixo,instance:void 0,opts:t}),i=new Pixo.Bridge(t),u.resolve(i),a.on("saveAsFail",g),e&&e()}var r,s,t,c,i,d=this,l=this.fm,a=$(o),p=a.children("img:first"),m=a.closest(".ui-dialog"),n=l.getUI(),u=$.Deferred(),f=$("#elfinder-pixo-container"),g=function(){m.addClass(l.res("class","preventback")),l.toggleMaximize(f,!0),l.toFront(f),f.show().data("curhash",d.file.hash),i.edit(p.get(0)),p.data("loading")(!0)};return p.data("loading")(),"image/jpeg"===d.file.mime&&(s=$('<input type="number" class="ui-corner-all elfinder-resize-quality elfinder-tabstop"/>').attr("min","1").attr("max","100").attr("title","1 - 100").on("change",function(){var e=s.val();t&&cancelAnimationFrame(t),t=requestAnimationFrame(function(){c&&c.toBlob(function(e){e&&s.next("span").text(" ("+l.formatSize(e.size)+")")},"image/jpeg",Math.max(Math.min(e,100),1)/100)})}).val(l.storage("jpgQuality")||l.option("jpgQuality")),r=$('<div class="ui-dialog-buttonset elfinder-edit-extras elfinder-edit-extras-quality"/>').hide().append($("<span>").html(l.i18n("quality")+" : "),s,$("<span/>")).prependTo(a.parent().next()),a.data("quty",s)),"undefined"==typeof Pixo?l.loadScript(["https://pixoeditor.com:8443/editor/scripts/bridge.m.js"],function(){e(g)},{loadType:"tag"}):(e(),g()),u},save:function(e){var t,i=$(e),a=i.children("img:first");e._canvas?(t=i.data("quty")?Math.max(Math.min(i.data("quty").val(),100),1)/100:void 0,a.attr("src",e._canvas.toDataURL(this.file.mime,t))):"data:"!==a.attr("src").substr(0,5)&&a.attr("src",function(t,e){var i,a,n,o=t.attr("style");try{t.attr("style",""),i=t.get(0),(a=document.createElement("canvas")).width=i.width,a.height=i.height,t.attr("style",o),a.getContext("2d").drawImage(i,0,0),n=a.toDataURL(e)}catch(e){n=t.attr("src")}return n}(a,this.file.mime))},close:function(e,t){t&&t.destroy()}}),parseInt(i.fm_aceeditor_editor_enable)&&""!==i.fm_aceeditor_editor_file_types&&n.push({mimes:i.fm_aceeditor_editor_file_types.split(","),setup:function(e,t){!t.UA.ltIE8&&t.options.cdns.ace||(this.disabled=!0)},info:{id:"aceeditor",name:"Edit With AceEditor",iconImg:"img/editor-icons.png 0 -96"},load:function(c){var d=this,e=this.fm,l=$.Deferred(),p=e.options.cdns.ace;return d.confObj.loader||(d.confObj.loader=$.Deferred(),d.fm.loadScript([p+"/ace.js"],function(){d.confObj.loader.resolve()},void 0,{obj:window,name:"ace"})),d.confObj.loader.done(function(){var e,t,i,a=$(c),n=a.parent(),o=n.parent(),r=c.id+"_ace",s=(d.file.name.replace(/^.+\.([^.]+)|(.+)$/,"$1$2").toLowerCase(),{"text/x-php":"php","application/x-php":"php","text/html":"html","application/xhtml+xml":"html","text/javascript":"javascript","application/javascript":"javascript","text/css":"css","text/x-c":"c_cpp","text/x-csrc":"c_cpp","text/x-chdr":"c_cpp","text/x-c++":"c_cpp","text/x-c++src":"c_cpp","text/x-c++hdr":"c_cpp","text/x-shellscript":"sh","application/x-csh":"sh","text/x-python":"python","text/x-java":"java","text/x-java-source":"java","text/x-ruby":"ruby","text/x-perl":"perl","application/x-perl":"perl","text/x-sql":"sql","text/xml":"xml","application/docbook+xml":"xml","application/xml":"xml"});n.height(n.height()),ace.config.set("basePath",p),t=$('<div id="'+r+'" style="width:100%; height:100%;"/>').text(a.val()).insertBefore(a.hide()),a.data("ace",!0),(e=ace.edit(r)).$blockScrolling=1/0,e.setOptions({theme:"ace/theme/monokai",fontSize:"14px",wrap:!0}),ace.config.loadModule("ace/ext/modelist",function(){"text"===(i=ace.require("ace/ext/modelist").getModeForPath("/"+d.file.name).name)&&s[d.file.mime]&&(i=s[d.file.mime]),n.prev().children(".elfinder-dialog-title").append(" ("+d.file.mime+" : "+i.split(/[\/\\]/).pop()+")"),e.setOptions({mode:"ace/mode/"+i}),"resolved"===l.state()&&o.trigger("resize")}),ace.config.loadModule("ace/ext/language_tools",function(){ace.require("ace/ext/language_tools"),e.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!1})}),ace.config.loadModule("ace/ext/settings_menu",function(){ace.require("ace/ext/settings_menu").init(e)}),e.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(e){d.doSave()}}),e.commands.addCommand({name:"closeEditor",bindKey:{win:"Ctrl-w|Ctrl-q",mac:"Command-w|Command-q"},exec:function(e){d.doCancel()}}),e.resize(),$('<div class="ui-dialog-buttonset"/>').css("float","left").append($("<button/>").html(d.fm.i18n("TextArea")).button().on("click",function(){a.data("ace")?(a.removeData("ace"),t.hide(),a.val(e.session.getValue()).show().trigger("focus"),$(this).text("AceEditor")):(a.data("ace",!0),t.show(),e.setValue(a.hide().val(),-1),e.focus(),$(this).html(d.fm.i18n("TextArea")))})).append($("<button>Ace editor setting</button>").button({icons:{primary:"ui-icon-gear",secondary:"ui-icon-triangle-1-e"},text:!1}).on("click",function(){e.showSettingsMenu(),$("#ace_settingsmenu").css("font-size","80%").find('div[contains="setOptions"]').hide().end().parent().parent().appendTo($("#elfinder"))})).prependTo(n.next()),d.trigger("Prepare",{node:c,editorObj:ace,instance:e,opts:{}}),l.resolve(e)}),l},close:function(e,t){t&&t.destroy()},save:function(e,t){t&&$(e).data("ace")&&(e.value=t.session.getValue())},focus:function(e,t){t&&$(e).data("ace")&&t.focus()},resize:function(e,t,i,a){t&&t.resize()}}),parseInt(i.fm_tinymce_editor_enable)&&""!==i.fm_tinymce_file_types&&n.push({info:{id:"tinymce",name:"TinyMCE",iconImg:"img/editor-icons.png 0 -64"},mimes:i.fm_tinymce_file_types.split(","),setup:function(e,t){var i=this;t.options.cdns.tinymce?(i.mceOpts={},e.extraOptions?(i.uploadOpts=Object.assign({},e.extraOptions.uploadOpts||{}),i.mceOpts=Object.assign({},e.extraOptions.tinymce||{})):i.uploadOpts={}):i.disabled=!0},load:function(l){var p=this,m=this.fm,u=$.Deferred();return p.confObj.loader||(p.confObj.loader=$.Deferred(),p.fm.loadScript([m.options.cdns.tinymce+(m.options.cdns.tinymce.match(/\.js/)?"":"/tinymce.min.js")],function(){p.confObj.loader.resolve()},{loadType:"tag"})),p.confObj.loader.done(function(){function s(){var e;tinymce.activeEditor.windowManager.windows?(e=tinymce.activeEditor.windowManager.windows[0],t=$(e?e.getEl():void 0).hide(),i=$("#mce-modal-block").hide()):t=$(".tox-dialog-wrap").hide()}function c(){i&&i.show(),t&&t.show()}var e,t,i,a=$(l).show().parent(),d=a.closest(".elfinder-dialog"),n=a.height(),o=a.outerHeight(!0)-n,r=tinymce.majorVersion;a.height(n),l._setHeight=function(e){if(r<5){var t,i=$(this).parent(),a=e||i.innerHeight(),n=0;i.find(".mce-container-body:first").children(".mce-top-part,.mce-statusbar").each(function(){n+=$(this).outerHeight(!0)}),t=a-n-o,i.find(".mce-edit-area iframe:first").height(t)}},e={selector:"#"+l.id,resize:!1,plugins:"print preview fullpage searchreplace autolink directionality visualblocks visualchars fullscreen image link media template codesample table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern help",toolbar:"formatselect | bold italic strikethrough forecolor backcolor | link image media | alignleft aligncenter alignright alignjustify | numlist bullist outdent indent | removeformat",image_advtab:!0,init_instance_callback:function(e){l._setHeight(n),d.one("beforedommove."+m.namespace,function(){tinymce.execCommand("mceRemoveEditor",!1,l.id)}).one("dommove."+m.namespace,function(){p.load(l).done(function(e){p.instance=e})}),u.resolve(e)},file_picker_callback:function(a,e,n){var t=m.getCommand("getfile"),i=function(){o.hasVar&&(t.callback=o.callback,t.options.folders=o.folders,t.options.multiple=o.multi,m.commandMap.open=o.open,o.hasVar=!1),d.off("resize close",i),c()},o={};return o.callback=t.callback,o.folders=t.options.folders,o.multi=t.options.multiple,o.open=m.commandMap.open,o.hasVar=!0,t.callback=function(e){var t,i;"directory"!==e.mime?(t=m.convAbsUrl(e.url),i=e.name+" ("+m.formatSize(e.size)+")","file"==n.filetype&&a(t,{text:i,title:i}),"image"==n.filetype&&a(t,{alt:i}),"media"==n.filetype&&a(t),d.trigger("togleminimize")):m.one("open",function(){m.commandMap.open="getfile"}).getCommand("open").exec(e.hash)},t.options.folders=!0,t.options.multiple=!1,m.commandMap.open="getfile",s(),d.trigger("togleminimize").one("resize close",i),m.toast({mode:"info",msg:m.i18n("dblclickToSelect")}),!1},images_upload_handler:function(e,t,i){var a=e.blob(),n=function(e){var t=e.data.dialog||{};(t.hasClass("elfinder-dialog-error")||t.hasClass("elfinder-confirm-upload"))&&(s(),t.trigger("togleminimize").one("resize close",o),m.unbind("dialogopened",n))},o=function(){d.off("resize close",o),c()},r=!0;a.name&&(r=void 0),m.bind("dialogopened",n).exec("upload",Object.assign({files:[a],clipdata:r},p.confObj.uploadOpts),void 0,m.cwd().hash).done(function(e){e.added&&e.added.length?m.url(e.added[0].hash,{async:!0}).done(function(e){c(),t(m.convAbsUrl(e))}).fail(function(){i(m.i18n("errFileNotFound"))}):i(m.i18n(e.error?e.error:"errUpload"))}).fail(function(e){var t=m.parseError(e);t&&("errUnknownCmd"===t?t="errPerm":"userabort"===t&&(t="errAbort")),i(m.i18n(t||"errUploadNoFiles"))})}},5<=r&&(e.height="100%"),p.trigger("Prepare",{node:l,editorObj:tinymce,instance:void 0,opts:e}),tinymce.init(Object.assign(e,p.confObj.mceOpts))}),u},close:function(e,t){t&&tinymce.execCommand("mceRemoveEditor",!1,e.id)},save:function(e,t){t&&t.save()},focus:function(e,t){t&&t.focus()},resize:function(e,t,i,a){t&&e._setHeight()}}),parseInt(i.fm_textarea_editor_enable)&&""!==i.fm_textarea_file_types&&n.push({mimes:i.fm_textarea_file_types.split(","),info:{id:"textarea",name:"TextArea",useTextAreaEvent:!0},load:function(e){this.trigger("Prepare",{node:e,editorObj:void 0,instance:void 0,opts:{}}),e.setSelectionRange&&e.setSelectionRange(0,0),$(e).trigger("focus").show()},save:function(){}}),n},window.elFinder);